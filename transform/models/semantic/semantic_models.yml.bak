version: 2

semantic_models:
  - name: claims
    description: "Claims semantic model for healthcare analytics"
    model: ref('fct_claim')
    defaults:
      agg_time_dimension: claim_date
    
    dimensions:
      - name: claim_date
        expr: claim_date
        type: time
        type_params:
          time_granularity: day
      - name: member_id
        expr: member_id
        type: categorical
      - name: provider_id
        expr: provider_id
        type: categorical
      - name: plan_id
        expr: plan_id
        type: categorical
      - name: claim_status
        expr: claim_status
        type: categorical
      - name: diagnosis_code
        expr: diagnosis_code
        type: categorical
      - name: procedure_code
        expr: procedure_code
        type: categorical
    
    measures:
      - name: total_claims
        description: "Total number of claims"
        agg: count
        expr: claim_id
      - name: total_claim_amount
        description: "Total billed claim amount"
        agg: sum
        expr: claim_amount
      - name: total_allowed_amount
        description: "Total allowed amount after adjudication"
        agg: sum
        expr: allowed_amount
      - name: total_paid_amount
        description: "Total amount paid on claims"
        agg: sum
        expr: paid_amount
      - name: avg_claim_amount
        description: "Average claim amount"
        agg: average
        expr: claim_amount
      - name: unique_members
        description: "Unique count of members with claims"
        agg: count_distinct
        expr: member_id
      - name: unique_providers
        description: "Unique count of providers with claims"
        agg: count_distinct
        expr: provider_id

  - name: enrollments
    description: "Enrollment semantic model for membership analytics"
    model: ref('fct_enrollment')
    defaults:
      agg_time_dimension: start_date
    
    dimensions:
      - name: start_date
        expr: start_date
        type: time
        type_params:
          time_granularity: day
      - name: end_date
        expr: end_date
        type: time
        type_params:
          time_granularity: day
      - name: member_id
        expr: member_id
        type: categorical
      - name: plan_id
        expr: plan_id
        type: categorical
      - name: csr_variant
        expr: csr_variant
        type: categorical
    
    measures:
      - name: total_enrollments
        description: "Total number of enrollment periods"
        agg: count
        expr: enrollment_id
      - name: total_coverage_days
        description: "Total coverage days across all enrollments"
        agg: sum
        expr: coverage_days
      - name: avg_coverage_days
        description: "Average coverage days per enrollment"
        agg: average
        expr: coverage_days
      - name: total_premium_paid
        description: "Total premium paid"
        agg: sum
        expr: premium_paid
      - name: avg_premium_paid
        description: "Average premium paid per enrollment"
        agg: average
        expr: premium_paid
      - name: unique_enrolled_members
        description: "Unique count of enrolled members"
        agg: count_distinct
        expr: member_id
      - name: unique_plans
        description: "Unique count of plans with enrollments"
        agg: count_distinct
        expr: plan_id

  - name: members
    description: "Member dimension semantic model"
    model: ref('dim_member')
    
    dimensions:
      - name: member_id
        expr: member_id
        type: categorical
      - name: age_group
        expr: age_group
        type: categorical
      - name: gender
        expr: gender
        type: categorical
      - name: region
        expr: region
        type: categorical
      - name: plan_metal
        expr: plan_metal
        type: categorical
    
    measures:
      - name: total_members
        description: "Total count of members"
        agg: count
        expr: member_id

  - name: plans
    description: "Plan dimension semantic model"
    model: ref('dim_plan')
    
    dimensions:
      - name: plan_id
        expr: plan_id
        type: categorical
      - name: metal_tier
        expr: metal_tier
        type: categorical
      - name: effective_year
        expr: effective_year
        type: categorical
    
    measures:
      - name: total_plans
        description: "Total count of plans"
        agg: count
        expr: plan_id
      - name: avg_monthly_premium
        description: "Average monthly premium across plans"
        agg: average
        expr: monthly_premium
      - name: avg_deductible
        description: "Average deductible across plans"
        agg: average
        expr: deductible
